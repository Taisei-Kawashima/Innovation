<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç·åˆå¥åº·ã‚¢ãƒ—ãƒª - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Lucide icons for clean, modern look -->
    <script type="module">
        import { createIcons, Activity, Moon, Heart, TrendingUp, AlertTriangle, ChevronRight, CheckCircle } from 'https://unpkg.com/lucide@latest/dist/esm/lucide.js';
        document.addEventListener('DOMContentLoaded', () => {
          createIcons({
            icons: { Activity, Moon, Heart, TrendingUp, AlertTriangle, ChevronRight, CheckCircle }
          });
        });
    </script>
    <style>
        /* ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šã¨æš–è‰²ç³»ã®ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ */
        :root {
            --color-primary: #FF7043; /* æš–è‰²ç³»ã®ã‚ªãƒ¬ãƒ³ã‚¸ */
            --color-secondary: #FFCC80; /* æ˜ã‚‹ã„ã‚ªãƒ¬ãƒ³ã‚¸ */
            --color-background: #F8F4F2; /* æš–ã‹ãªã‚ªãƒ•ãƒ›ãƒ¯ã‚¤ãƒˆ */
            --color-surface: #FFFFFF;
            --color-alert: #EF5350; /* è­¦å‘Šãƒ¬ãƒƒãƒ‰ */
            --color-safe: #66BB6A; /* å®‰å…¨ã‚°ãƒªãƒ¼ãƒ³ */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-background);
            /* bodyå…¨ä½“ãŒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ã¨ãªã‚‹ */
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }
        .header-content {
            padding: 16px 20px;
            background-color: var(--color-surface);
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 5;
        }
        .card {
            background-color: var(--color-surface);
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 16px;
        }
        .btn-primary {
            background-color: var(--color-primary);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background-color: #E64A19;
        }
        .gauge-ring {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: grid;
            place-items: center;
            position: relative;
        }
        .gauge-svg {
            position: absolute;
            transform: rotate(-90deg);
        }
        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚° */
        .app-content {
            padding: 16px; /* bodyã®p-4ã‚’ã‚ˆã‚Šæ¨™æº–çš„ãªãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã«å¤‰æ›´ */
        }
    </style>
</head>
<body>

<!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
<div class="app-content max-w-xl mx-auto">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header-content mb-4">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold text-gray-800">Hello, ãƒ¦ãƒ¼ã‚¶ãƒ¼å ğŸ‘‹</h1>
            <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center text-sm font-semibold text-gray-600">
                <img src="https://placehold.co/40x40/FF7043/ffffff?text=U" alt="Profile" class="rounded-full">
            </div>
        </div>
        <!-- ãƒ‡ãƒ¼ã‚¿é€£æºã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
        <div class="flex items-center text-sm text-gray-500 mb-2">
            <i data-lucide="check-circle" class="w-4 h-4 mr-1 text-green-500"></i>
            <span>Health Connectã¨é€£æºæ¸ˆã¿</span>
        </div>
    </div>

    <!-- 1. è­¦å‘Šãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ (ç‹¬è‡ªæ€§: æ”¹å–„ã‚¢ãƒ‰ãƒã‚¤ã‚¹) -->
    <div class="card bg-orange-50 border-l-4 border-[--color-alert]" id="alert-card">
        <div class="flex items-start">
            <i data-lucide="alert-triangle" class="w-6 h-6 mr-3 text-[--color-alert] mt-1"></i>
            <div>
                <h2 class="text-lg font-semibold text-gray-800 mb-1">ã€è­¦å‘Šã€‘ç¡çœ è² å‚µãŒè“„ç©ã—ã¦ã„ã¾ã™</h2>
                <p class="text-gray-600 text-sm">éå»3æ—¥é–“ã®å¹³å‡ç¡çœ æ™‚é–“ãŒç›®æ¨™ã‚ˆã‚Š90åˆ†ä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã¾ã¾ã§ã¯é›†ä¸­åŠ›ä½ä¸‹ã«ç¹‹ãŒã‚Šã¾ã™ã€‚</p>
            </div>
        </div>
        <div class="mt-4 pt-3 border-t border-orange-200">
            <p class="text-sm font-semibold text-[--color-primary] flex justify-between items-center">
                ä»Šå¤œã®ç›®æ¨™ï¼š23:00å°±å¯ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†
                <i data-lucide="chevron-right" class="w-4 h-4"></i>
            </p>
        </div>
    </div>

    <!-- 2. å¥åº·ã‚¹ã‚³ã‚¢ãƒ»è¡Œå‹•ã‚µãƒãƒªãƒ¼ (ç‹¬è‡ªæ€§: ãƒ‡ãƒ¼ã‚¿çµ±åˆ) -->
    <div class="card">
        <h2 class="text-xl font-bold text-gray-800 mb-4">ç·åˆå¥åº·ã‚¹ã‚³ã‚¢</h2>
        <div class="flex items-center justify-between">
            <!-- ã‚¹ã‚³ã‚¢ã®ã‚²ãƒ¼ã‚¸ -->
            <div class="gauge-ring bg-gray-100">
                <svg class="gauge-svg" width="100" height="100" viewBox="0 0 100 100">
                    <!-- Background arc (Stroke-dasharray is used to simulate the gauge) -->
                    <circle cx="50" cy="50" r="45" fill="none" stroke="#E0E0E0" stroke-width="8" />
                    <!-- Foreground arc (Simulate 75% score) -->
                    <circle id="gauge-arc" cx="50" cy="50" r="45" fill="none" stroke="var(--color-primary)" stroke-width="8"
                            stroke-dasharray="282.6" stroke-dashoffset="70.65" style="transition: stroke-dashoffset 0.5s ease;"/>
                </svg>
                <div class="text-3xl font-bold text-[--color-primary] z-10" id="score-value">75<span class="text-lg text-gray-600">/100</span></div>
            </div>
            <!-- ä¸»è¦ãªæŒ‡æ¨™ -->
            <div class="w-2/3 space-y-2">
                <div class="flex items-center justify-between">
                    <span class="flex items-center text-gray-600 text-sm"><i data-lucide="activity" class="w-4 h-4 mr-1 text-green-500"></i> é‹å‹•</span>
                    <span class="font-semibold text-gray-800" id="exercise-text">è‰¯å¥½ (+5P)</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="flex items-center text-gray-600 text-sm"><i data-lucide="moon" class="w-4 h-4 mr-1 text-orange-500"></i> ç¡çœ </span>
                    <span class="font-semibold text-gray-800" id="sleep-text">è¦æ”¹å–„ (-10P)</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="flex items-center text-gray-600 text-sm"><i data-lucide="heart" class="w-4 h-4 mr-1 text-green-500"></i> å¿ƒæ‹æ•°</span>
                    <span class="font-semibold text-gray-800" id="heart-text">å®‰å®š (+2P)</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. æ¬¡ã®å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ (ç‹¬è‡ªæ€§: è¡Œå‹•å¤‰å®¹) -->
    <div class="card">
        <h2 class="text-lg font-semibold text-gray-800 mb-3">ä»Šæ—¥ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
        <ul class="space-y-3">
            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é …ç›® 1 -->
            <li class="bg-blue-50 p-3 rounded-lg flex items-center justify-between shadow-sm">
                <div class="flex items-center">
                    <span class="inline-block w-2 h-2 rounded-full bg-blue-500 mr-2"></span>
                    <p class="text-sm font-medium text-gray-700">ã€é‹å‹•ã€‘ã‚ã¨15åˆ†è»½ã„ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°**ã‚’ã™ã‚‹</p>
                </div>
                <i data-lucide="chevron-right" class="w-4 h-4 text-blue-500"></i>
            </li>
            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é …ç›® 2 -->
            <li class="bg-red-50 p-3 rounded-lg flex items-center justify-between shadow-sm">
                <div class="flex items-center">
                    <span class="inline-block w-2 h-2 rounded-full bg-red-500 mr-2"></span>
                    <p class="text-sm font-medium text-gray-700">ã€é£Ÿäº‹ã€‘å¤•é£Ÿã®å¡©åˆ†æ‘‚å–é‡ã‚’1gæ¸›ã‚‰ã™</p>
                </div>
                <i data-lucide="chevron-right" class="w-4 h-4 text-red-500"></i>
            </li>
        </ul>
        <p class="text-xs text-gray-500 mt-4">â€»ã“ã‚Œã‚‰ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€éå»ã®ãƒ‡ãƒ¼ã‚¿ã¨ä»Šæ—¥ã®æ´»å‹•çŠ¶æ³ã«åŸºã¥ã„ã¦ææ¡ˆã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
    </div>

    <!-- 4. ãƒ‡ãƒ¼ã‚¿æ¨ç§»ï¼ˆã‚°ãƒ©ãƒ•ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰ -->
    <div class="card">
        <h2 class="text-lg font-semibold text-gray-800 mb-3">éå»7æ—¥é–“ã®æ´»å‹•ãƒˆãƒ¬ãƒ³ãƒ‰</h2>
        <div class="flex justify-between items-center text-sm text-gray-500 mb-3">
            <span>é‹å‹•æ™‚é–“ (åˆ†)</span>
            <span class="text-green-600 flex items-center"><i data-lucide="trending-up" class="w-4 h-4 mr-1"></i> +15%</span>
        </div>
        <!-- ã‚°ãƒ©ãƒ•ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ -->
        <div class="bg-gray-100 h-40 rounded-lg flex items-center justify-center text-gray-500 text-sm">
            <!-- å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯ã“ã“ã«å‹•çš„ãªã‚°ãƒ©ãƒ•ï¼ˆä¾‹ï¼šD3.jsï¼‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ -->
            ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢ï¼ˆé‹å‹•ã€ç¡çœ ãªã©ã®æ¨ç§»ã‚’è¡¨ç¤ºï¼‰
        </div>
    </div>

    <!-- 5. ä½ã‚³ã‚¹ãƒˆã‚¢ãƒ”ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ -->
    <div class="card bg-[--color-primary] text-white">
        <h2 class="text-xl font-bold mb-2">ä½ã‚³ã‚¹ãƒˆã§ã€ã‚ãªãŸã®å¥åº·ç¿’æ…£ã‚’ã‚µãƒãƒ¼ãƒˆã€‚</h2>
        <p class="text-sm opacity-90">ã‚¹ãƒãƒ¼ãƒˆã‚¦ã‚©ãƒƒãƒã¯ä¸è¦ã€‚ä»–ç¤¾ã«æ¯”ã¹ã¦å¹´é–“ã§æ•°ä¸‡å††ã®ç¯€ç´„ãŒå¯èƒ½ã§ã™ã€‚</p>
        <button class="mt-4 bg-white text-[--color-primary] font-bold py-2 px-4 rounded-full text-sm shadow-md transition-transform transform hover:scale-[1.02]">
            å¹´é–“ã‚³ã‚¹ãƒˆæ¯”è¼ƒã‚’è¦‹ã‚‹
        </button>
    </div>

    <!-- ä¸‹éƒ¨ã®ä½™ç™½ -->
    <div class="h-10"></div>
</div>

<script>
    // Expose updateHealthData for Kotlin evaluateJavascript to call
    window.updateHealthData = function(data) {
        try {
            if (typeof data === 'string') data = JSON.parse(data);
        } catch (e) {
            console.warn('updateHealthData: invalid payload', e);
            return;
        }

        console.log('updateHealthData called', data);

        const score = Number(data.exerciseScore ?? 0);
        const sleepHours = Number(data.sleepHours ?? 0);
        const steps = Number(data.steps ?? 0);
        const heartRate = Number(data.heartRate ?? 0);

        // Update gauge
        const gauge = document.querySelector('#gauge-arc');
        const scoreDisplay = document.getElementById('score-value');
        if (gauge) {
            const r = 45;
            const circumference = 2 * Math.PI * r;
            const offset = circumference * (1 - Math.max(0, Math.min(1, score / 100)));
            gauge.style.strokeDashoffset = offset;
        }
        if (scoreDisplay) {
            scoreDisplay.innerHTML = `${score}<span class="text-lg text-gray-600">/100</span>`;
        }

        // Update texts
        const exerciseText = document.getElementById('exercise-text');
        const sleepText = document.getElementById('sleep-text');
        const heartText = document.getElementById('heart-text');
        const alertCard = document.getElementById('alert-card');
        const sleepDeficit = document.getElementById('sleep-deficit');

        if (exerciseText) exerciseText.innerText = (score >= 70) ? `è‰¯å¥½ (+${Math.round((score-70)/1)}P)` : `è¦æ”¹å–„ (${score}P)`;
        if (sleepText) sleepText.innerText = `${sleepHours}æ™‚é–“`;
        if (heartText) heartText.innerText = `${heartRate} bpm`;

        if (sleepHours < 7) {
            if (sleepDeficit) sleepDeficit.innerText = `${Math.round((7 - sleepHours) * 60)}åˆ†`;
            if (alertCard) alertCard.style.display = 'block';
        } else {
            if (alertCard) alertCard.style.display = 'none';
        }
    };

    // Expose a function to show connection status
    window.setHealthConnectStatus = function(connected) {
        const el = document.querySelector('.header-content .text-sm span') || document.getElementById('hc-status');
        if (el) {
            el.innerText = connected ? 'Health Connectã¨é€£æºæ¸ˆã¿' : 'æœªé€£æº - è¨­å®šã‹ã‚‰æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„';
        }
        console.log('setHealthConnectStatus', connected);
    };

    // Function to receive and update health data from Kotlin
    window.updateHealthData = function(data) {
        console.log('ğŸ“Š updateHealthData called with:', data);

        if (typeof data === 'string') {
            try {
                data = JSON.parse(data);
            } catch(e) {
                console.error('Failed to parse data:', e);
                return false;
            }
        }

        const { exerciseScore, sleepHours, steps, heartRate } = data;

        // Update exercise score gauge
        const gaugeCircle = document.querySelector('.gauge-svg circle:nth-child(2)');
        const scoreDisplay = document.querySelector('.gauge-ring > div');
        if (gaugeCircle && scoreDisplay) {
            const circumference = 2 * Math.PI * 45;
            const offset = circumference - (exerciseScore / 100) * circumference;
            gaugeCircle.style.strokeDashoffset = offset;
            scoreDisplay.innerHTML = `${exerciseScore}<span class="text-lg text-gray-600">/100</span>`;
            console.log('âœ“ Updated exercise score:', exerciseScore);
        }

        // Update sleep hours
        const sleepElement = document.querySelector('h3:nth-of-type(1)')?.parentElement?.querySelector('p') ||
                            document.getElementById('sleep-hours');
        if (sleepElement) {
            sleepElement.innerText = `${sleepHours.toFixed(1)}æ™‚é–“`;
            console.log('âœ“ Updated sleep hours:', sleepHours);
        }

        // Update steps
        const stepsElement = document.querySelector('h3:nth-of-type(2)')?.parentElement?.querySelector('p') ||
                            document.getElementById('steps-count');
        if (stepsElement) {
            stepsElement.innerText = `${steps.toLocaleString()}æ­©`;
            console.log('âœ“ Updated steps:', steps);
        }

        // Update heart rate
        const hrElement = document.querySelector('h3:nth-of-type(3)')?.parentElement?.querySelector('p') ||
                         document.getElementById('heart-rate');
        if (hrElement) {
            hrElement.innerText = `${heartRate} bpm`;
            console.log('âœ“ Updated heart rate:', heartRate);
        }

        console.log('âœ… updateHealthData completed');
        return true;
    };

    // Keep existing initializeApp behavior for local debugging
    const fetchHealthData = async () => {
        console.log('Local fetchHealthData running (debug)');
        const score = 75;
        const gaugeCircle = document.querySelector('.gauge-svg circle:nth-child(2)');
        const scoreDisplay = document.querySelector('.gauge-ring > div');
        const circumference = 2 * Math.PI * 45;
        const offset = circumference - (score / 100) * circumference;
        if (gaugeCircle) gaugeCircle.style.strokeDashoffset = offset;
        if (scoreDisplay) scoreDisplay.innerHTML = `${score}<span class="text-lg text-gray-600">/100</span>`;
    };

    const initializeApp = () => {
        fetchHealthData();
    };

    document.addEventListener('DOMContentLoaded', () => {
        initializeApp();
        // Also set a visible initial status
        try { window.setHealthConnectStatus(false); } catch(e){}
    });
</script>

</body>
</html>
